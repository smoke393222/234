# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –∏–∑ API 3x-ui

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏** –∏–∑ API 3x-ui –≤–º–µ—Å—Ç–æ –∏—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫—É –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**: VLESS+REALITY, VLESS+TLS, VMess, Trojan
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ—Ä—É—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏–Ω–±–∞—É–Ω–¥–∞
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞–¥–∞–ø—Ç–∞—Ü–∏—é**: —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–∞–Ω–µ–ª–∏

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
–ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏:
1. –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∏–Ω–±–∞—É–Ω–¥–µ —á–µ—Ä–µ–∑ API
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç UUID –∏ inbound_id –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è":
1. –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–Ω–±–∞—É–Ω–¥–∞ –∏–∑ API
2. –ü–∞—Ä—Å–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (protocol, streamSettings, security)
3. –ù–∞—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ email
4. –°—Ç—Ä–æ–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### 3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

#### VLESS
- ‚úÖ VLESS + TLS
- ‚úÖ VLESS + REALITY (—Å pbk, fp, sid, spx)
- ‚úÖ VLESS + WebSocket
- ‚úÖ VLESS + gRPC
- ‚úÖ VLESS + TCP —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- ‚úÖ Flow (xtls-rprx-vision –∏ –¥—Ä.)

#### VMess
- ‚úÖ VMess + TLS
- ‚úÖ VMess + WebSocket
- ‚úÖ VMess + TCP

#### Trojan
- ‚úÖ Trojan + TLS
- ‚úÖ Trojan + WebSocket

### 4. –ü—Ä–∏–º–µ—Ä –¥–ª—è REALITY

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```
vless://uuid@server:443?type=tcp&encryption=none&security=reality&pbk=...&fp=random&sni=your-sni.com&sid=...&spx=/&flow=xtls-rprx-vision
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç `security=reality`
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç `publicKey` ‚Üí `pbk`
3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç `fingerprint` ‚Üí `fp`
4. –ò–∑–≤–ª–µ–∫–∞–µ—Ç `serverNames[0]` ‚Üí `sni`
5. –ò–∑–≤–ª–µ–∫–∞–µ—Ç `shortIds[0]` ‚Üí `sid`
6. –ò–∑–≤–ª–µ–∫–∞–µ—Ç `spiderX` ‚Üí `spx`
7. –î–æ–±–∞–≤–ª—è–µ—Ç `flow` –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–ª–∏–µ–Ω—Ç–∞
8. –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ `XUIClient`:

```python
async def get_client_link(inbound_id: int, email: str) -> Optional[str]
```
–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞.

```python
async def _build_vless_link(...) -> str
async def _build_vmess_link(...) -> str
async def _build_trojan_link(...) -> str
```
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:

`bot/handlers/user.py` ‚Üí `show_connection()`
- –¢–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç `get_client_link()` –≤–º–µ—Å—Ç–æ `generate_vless_qr()`
- –ï—Å—Ç—å fallback –Ω–∞ —Ä—É—á–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`:
```env
BOT_TOKEN=...
ADMIN_TG_ID=...
XUI_BASE_URL=https://your-server.com
XUI_USERNAME=admin
XUI_PASSWORD=your_password
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (fallback):
```env
VLESS_SERVER=your-server.com
VLESS_PORT=443
VLESS_SNI=your-server.com
```

–≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
- API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–Ω–±–∞—É–Ω–¥–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–±–µ–∑ inbound_id)

## –ú–∏–≥—Ä–∞—Ü–∏—è

### –î–ª—è –Ω–æ–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
–ü—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞.

### –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—Ç–∞:

1. **–°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (–±–µ–∑ inbound_id):
   - –ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
   - –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å –∏—Ö —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å

2. **–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏–∑ API
   - –ë—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**:
   - –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
   - –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ `inbound_id` –≤ —Ç–∞–±–ª–∏—Ü—É `users`

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
‚ùå –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–æ–π VLESS+TLS
‚ùå –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å REALITY
‚ùå –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å .env –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
‚úÖ –í—Å–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ REALITY
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø–∞–Ω–µ–ª—å—é 3x-ui
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —É–¥–∞–ª–µ–Ω–Ω–æ –Ω–∞ VPS –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `/settings` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–Ω–±–∞—É–Ω–¥—ã
2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –û–¥–æ–±—Ä–∏—Ç–µ –∑–∞—è–≤–∫—É, –≤—ã–±—Ä–∞–≤ –∏–Ω–±–∞—É–Ω–¥
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
5. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```
INFO: Getting client link: inbound_id=1, email=user_123
INFO: Successfully generated link for user_123
```

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:
```
WARNING: Could not get link from API, generating manually for user_123
ERROR: Error getting client link: ...
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API 3x-ui –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å XUI_USERNAME –∏ XUI_PASSWORD
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å inbound_id –≤ –±–∞–∑–µ
